import sys

import requests
import json


def list_get(data):
	url = "https://mb-api.abuse.ch/api/v1/"

	proxys = {}
	# proxys = {'https': 'http://127.0.0.1:7890'}
	respTxt = requests.post(url, data=data, timeout=300, proxies=proxys).text

	jsondata = json.loads(respTxt)
	status=jsondata['query_status']
	# 输出查询状态
	# 打印请求状态
	print('status:' + status)

	if status!='ok':
		sys.exit(0)

	data_list = jsondata['data']
	# 打印请求到的数据
	print('data:' + str(data_list))

	return data_list


def sha256_list_get(data_list):
	# list[0]表示某软件全部信息，是字典
	# data_list[0]['sha256_hash']是它的sha256值
	sha256_list = []
	for i in data_list:
		sha256_list.append(i['sha256_hash'])
	# print(sha256_list)
	return sha256_list


def query_signature(signature_name, limit):
	data = {'query': 'get_siginfo', 'signature': signature_name, 'limit': limit}
	list = sha256_list_get(list_get(data))
	return list


def query_tag(tag_name, limit):
	data = {'query': 'get_taginfo', 'tag': tag_name, 'limit': limit}
	list = sha256_list_get(list_get(data))
	return list


if __name__ == '__main__':
	limit = 10
	list1 = query_signature('CoinMiner', limit)
	sha256_list_get(list1)
