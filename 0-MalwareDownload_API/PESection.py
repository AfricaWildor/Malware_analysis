import pefile
from capstone import *
import pyzipper
from pyzipper import AESZipFile

def getSection(filebytes):

	pe = pefile.PE(data=filebytes)
	return pe.sections


def main(filepath):

	zipfile = AESZipFile(filepath)
	filelist = zipfile.namelist()
	#print(filelist)
	writeFile = "E:\\malware-classification\\secTable.txt"

	print("zip list getted")
	with open(writeFile, 'w+') as wrfile:
		i = 0
		for file in filelist:
			i += 1
			if i == 10000:
				break
			try :
				filebytes = zipfile.read(file)
			except Exception as e:
				print(e)
				i += -1
				continue
			#print(type(file))
			#print(file)
			#print(filebytes)
			print(i)
			if filebytes!= b"":
				fileSections = getSection(filebytes)
				#print(fileSections)
				wrfile.write(file+"\n")
				wrfile.write(str(i)+" : "+str(fileSections)+"\n")


if __name__ == '__main__':
	zippath = "E:\\malware-classification\\BODMAS_samples\\BODMAS_disarmed_malware_binaries-001.zip"
	main(zippath)
