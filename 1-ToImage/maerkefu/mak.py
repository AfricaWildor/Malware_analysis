from PIL import Image, ImageDraw
import os, sys, array, math
import numpy as np


def file2arr(file_path, *file_save_path):
    with open(file_path, mode='rb') as f:
        buffer = array.array('B', f.read())

    array1 = np.zeros((256, 256), dtype=int)

    for i in range(len(buffer) - 2):
        j = i + 1
        array1[buffer[i]][buffer[j]] += 1

    trun_array = np.zeros(256, dtype=int)
    for i in range(256):
        for j in range(256):
            trun_array[i] += array1[i][j]

    array2 = np.zeros((256, 256), dtype=float)
    for i in range(256):
        for j in range(256):
            if (trun_array[i] != 0):
                array2[i][j] = array1[i][j] / trun_array[i]

    # print(array2)

    array3 = np.zeros((256, 256), dtype=int)
    for i in range(256):
        for j in range(256):
            rgb = math.ceil(255 * array2[i][j])
            array3[i][j] = rgb

    array4 = 255 - array3
    array5 = (100/255)*array3 + 150

    img = Image.fromarray(array3.astype("uint8"))
    img1 = Image.fromarray(array4.astype("uint8"))
    img2 = Image.fromarray(array5.astype("uint8"))

    img.save(file_save_path[0])
    img1.save(file_save_path[1])
    img2.save(file_save_path[2])
    # np.save(file_save_path, array2)


file2arr("./rc4.exe", "./mak.png", "./mak1.png", "./mak2.png")
