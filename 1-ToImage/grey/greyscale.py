from PIL import Image, ImageDraw
import os, sys, array, math
import numpy as np


def file2arr(bytearr, file_save_path):
    c = Image.new("L", (256, 256))
    c.putdata(bytearr)
    c.save(file_save_path)



if __name__ == '__main__':

    file_list = os.listdir("E:/malware-classification/set/train")

    for file in file_list:
        if file.find(".bytes") >= 0:
            bytes_list = b''
            line = 0
            with open(os.path.join("E:/malware-classification/set/train", file), mode="r") as f:
                for l in f:
                    if l.find("?") >= 0:
                        continue
                    str_list = l.split(" ")[1:]
                    b = bytes.fromhex("".join(str_list))
                    bytes_list += b
                    line = line + 1
                    if line == 4096:
                        break

            if len(bytes_list) == 0:
                    print(f"{file} is empty")
                    continue

            file2arr(bytes_list,"E:/malware-classification/img/grayscale_train_set_img/"+file+".png")
            print(file+".png"+" done!")

    # bytes_list = b''
    # line = 0
    # with open(os.path.join("./", "0A32eTdBKayjCWhZqDOQ.bytes"), mode="r") as f:
    #     for l in f:
    #         if l.find("?") >= 0:
    #             continue
    #         str_list = l.split(" ")[1:]
    #         b = bytes.fromhex("".join(str_list))
    #         bytes_list += b
    #         line = line + 1
    #         if line == 4096:
    #             break
    #     file2arr(bytes_list, "./a.png")
